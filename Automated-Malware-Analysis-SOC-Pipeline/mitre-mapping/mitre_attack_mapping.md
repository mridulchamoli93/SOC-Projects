# MITRE ATT&CK Mapping – Automated Malware Analysis & SOC Pipeline

This document maps the key behaviors observed in the lab (from `auditd` logs, fake ransomware execution, and system activity) to the MITRE ATT&CK framework.

---

## 1. Execution

### T1059.004 – Command and Scripting Interpreter: Unix Shell
**Description:** Adversaries may abuse `/bin/sh`, `/bin/bash`, or other shells to execute arbitrary commands or scripts.

**Where in lab:**
- Execution of shell wrappers and helper scripts (e.g., `/bin/sh -e -u -c ...` from snap / firefox wrappers).
- Execution of simulated malware scripts such as `fake_ransom.sh` in the dynamic-analysis phase.

**Evidence examples:**
- `COMMAND="sh" exe="/usr/bin/dash" ... key="exec_monitor"`
- `COMMAND="bash" ...`  
- Dynamic malware test using `fake_ransom.sh` in `dynamic-analysis/`.

---

### T1204 – User Execution
**Description:** The attack chain is initiated by a user or operator launching an application which then performs malicious or suspicious actions.

**Where in lab:**
- Manual execution of Firefox via snap that triggers a chain of commands (chmod, ln, rm, snapctl) inside the sandboxed environment.

**Evidence examples:**
- `COMMAND="firefox" exe="/usr/bin/snap" subj=unconfined key="exec_monitor"`
- `COMMAND="firefox" exe="/snap/firefox/4848/usr/lib/firefox/firefox" subj=snap.firefox.firefox key="exec_monitor"`

---

## 2. Persistence

### T1053.003 – Scheduled Task/Job: Cron
**Description:** Adversaries may use cron jobs to execute commands or scripts for persistence.

**Where in lab:**
- In the malware lab design, a cron-based persistence mechanism is used to simulate a ransomware task repeatedly running and writing to a log (e.g., `/etc/cron.d/persist_test` writing to `/tmp/persist.log`).

**Evidence (conceptual in this project):**
- Cron entry created for persistence (ransomware / test payload).
- Telemetry captured by `auditd` rules targeting cron-related activity.

---

### T1547 (Approximate) – Boot or Logon Autostart Execution (Filesystem-Based)
**Description:** Adversaries may abuse filesystem locations and configuration paths that are loaded automatically or used by applications at start-up.

**Where in lab:**
- Use of symbolic links pointing from snap / Firefox configuration paths to other user config locations, simulating a persistence-like behavior.

**Evidence examples:**
- `COMMAND="ln" exe="/usr/bin/ln" subj=snap.firefox.firefox key="exec_monitor"`
- `ln -sfn /home/kali/.config/ibus/bus /home/kali/snap/firefox/4848/.config/ibus`
- `ln -sf ../../dconf/user /run/user/1000/snap.firefox/dconf/user`

*(Note: This is mapped approximately to persistence behavior because the symlinks make the application repeatedly use attacker-controlled or modified config paths.)*

---

## 3. Privilege & Account Abuse

### T1078 – Valid Accounts
**Description:** Adversaries may abuse valid user accounts to execute commands with elevated privileges.

**Where in lab:**
- Use of `sudo` to run commands as root during the attack simulation and lab operations.

**Evidence examples:**
- `COMMAND="sudo" exe="/usr/bin/sudo" subj=unconfined key="exec_monitor"`

In the lab narrative, this represents an attacker (or operator emulating one) using valid credentials to perform privileged actions.

---

## 4. Defense Evasion & File/Permission Tampering

### T1222.002 – File and Directory Permissions Modification: Linux and Mac
**Description:** Adversaries may modify file or directory permissions to restrict or expand access.

**Where in lab:**
- Changing permissions on Firefox/snap configuration directories to tighten or control access.

**Evidence examples:**
- `COMMAND="chmod" exe="/usr/bin/chmod" subj=snap.firefox.firefox key="exec_monitor"`
- `COMMAND="chmod" exe="/usr/bin/chmod" subj=unconfined key="malware_lab"`
- Example: `chmod 700 /home/kali/snap/firefox/4848/.config`

---

### T1070.004 – Indicator Removal on Host: File Deletion
**Description:** Adversaries may delete files and directories to remove evidence or break functionality.

**Where in lab:**
- Deletion of ibus / config paths within snap / Firefox directories as part of the simulated malicious behavior chain.

**Evidence examples:**
- `COMMAND="rm" exe="/usr/bin/rm" subj=snap.firefox.firefox key="exec_monitor"`
- `COMMAND="rm" exe="/usr/bin/rm" subj=unconfined key="exec_monitor"`
- Example: `rm -rf /home/kali/snap/firefox/4848/.config/ibus/bus`

---

## 5. Discovery

### T1082 – System Information Discovery
**Description:** Adversaries may query the environment to understand capabilities, integrations, and available resources.

**Where in lab:**
- Use of `snapctl is-connected` commands to check available desktop, gsettings, and other snap interfaces — effectively checking what the environment allows.

**Evidence examples:**
- `COMMAND="snapctl" exe="/usr/lib/snapd/snapctl" subj=snap.firefox.firefox key="exec_monitor"`
- Examples:
  - `snapctl is-connected desktop`
  - `snapctl is-connected gsettings`
  - `snapctl is-connected gnome-42-2204`

These calls simulate environment/capability discovery via snap integration.

---

## 6. Impact

### T1485 – Data Destruction
**Description:** Adversaries may destroy data stored on a system to disrupt availability or hinder recovery.

**Where in lab:**
- Use of `rm -rf` in critical configuration directories within the sandboxed environment.

**Evidence examples:**
- `COMMAND="rm" exe="/usr/bin/rm" ...`
- Example: `rm -rf /home/kali/snap/firefox/4848/.config/ibus/bus`

---

### T1486 – Data Encrypted for Impact (Simulated)
**Description:** Adversaries may encrypt data on systems to interrupt access and demand ransom.

**Where in lab:**
- The `fake_ransom.sh` script in `dynamic-analysis/` simulates ransomware behavior (mass file modification / encryption) for detection and SOC correlation testing.

**Evidence examples:**
- Execution of `fake_ransom.sh` against test directories.
- Resulting file changes logged by `auditd` and forwarded to SIEM for alerting.

---

## 7. Summary

This lab ties together:

- **Execution:** T1059.004, T1204  
- **Persistence:** T1053.003, approximate filesystem-based persistence (T1547-like)  
- **Account Abuse:** T1078  
- **Defense Evasion / Tampering:** T1222.002, T1070.004  
- **Discovery:** T1082  
- **Impact:** T1485, T1486 (simulated)

These mappings show that the **Automated Malware Analysis & SOC Pipeline** is not just a “tool setup” project, but a full **ATT&CK-aligned detection and response lab** suitable for SOC interviews and resume presentation.
